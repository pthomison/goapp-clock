version: "3"

tasks:
  tidy-n-fmt:
    cmds:
      - go mod tidy
      - go fmt

  npm-deps:
    cmds:
      - npm install

  bundle:
    cmds:
      - ./node_modules/.bin/esbuild index.js --bundle --outfile=./web/index.js

  build-webapp:
    cmds:
      - task: tidy-n-fmt
      - task: bundle
      - GOARCH=wasm GOOS=js go build -o web/app.wasm .

  build:
    cmds:
      - task: build-webapp
      - go build -o tmp/goappclock .

  gh-pages:
    cmds:
      - task: build
      - rm -rf ./docs
      - ./tmp/goappclock --build --path goapp-clock --out docs
      - cp -R ./web/* ./docs/web/

  static:
    cmds:
      - task: build
      - rm -rf ./goapp-clock
      - ./tmp/goappclock --build --path goapp-clock --out goapp-clock
      - cp -R ./web/* ./goapp-clock/web/

  static-host:
    cmds:
      - task: static
      - python3 -m http.server --directory . 8888
